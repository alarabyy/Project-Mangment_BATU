<!-- نستخدم كلاسات الأنيميشن هنا -->
<div class="popup-overlay"
     *ngIf="state.isOpen"
     [class.fade-out]="isClosing"
     (click)="onOverlayClick()">

  <div class="popup-container"
       [ngClass]="state.type || 'info'"
       [class.slide-out-down]="isClosing"
       (click)="$event.stopPropagation()">

    <!-- الأيقونة التي تطفو فوق الصندوق -->
    <div class="popup-icon-wrapper">
      <div class="popup-icon">
        <i class="fas" [ngClass]="{
          'fa-check-circle': state.type === 'success',
          'fa-exclamation-triangle': state.type === 'error',
          'fa-question-circle': state.type === 'confirm'
        }"></i>
      </div>
    </div>

    <!-- المحتوى -->
    <h2 class="popup-title">{{ state.title }}</h2>
    <p class="popup-message" [innerHTML]="state.message"></p>

    <!-- الأزرار -->
    <div class="popup-actions">
      <!-- FIX: تم ربط زر الإلغاء بـ onCancelClick() -->
      <button *ngIf="state.type === 'confirm'" class="btn btn-secondary" (click)="onCancelClick()">
        {{ state.cancelButtonText }}
      </button>

      <!-- FIX: تم ربط الزر الرئيسي بـ onConfirmClick() -->
      <button class="btn btn-primary" (click)="onConfirmClick()">
        {{ state.confirmButtonText }}
      </button>
    </div>
  </div>
</div>
