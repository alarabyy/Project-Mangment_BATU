<!-- src/app/components/mail/mail-compose/mail-compose.component.html -->
<div class="compose-container">
  <div class="compose-card">
    <div class="section-header">
      <h2 class="section-title"><i class="fas fa-paper-plane section-title-icon"></i> Compose New Email</h2>
      <p class="section-subtitle">Send a message to the support team or any recipient.</p>
    </div>

    <form #mailComposeForm="ngForm" (ngSubmit)="onSubmit()" novalidate>
      <div class="form-group">
        <label for="composeName">Your Name:</label>
        <input type="text" id="composeName" name="composeName" [(ngModel)]="composeMailData.name"
               #composeName="ngModel" placeholder="Your Name" required minlength="2" maxlength="20"> <!-- NEW: maxlength="20" -->
        <!-- رسائل التحقق للاسم -->
        <div *ngIf="composeName.invalid && (composeName.dirty || composeName.touched)" class="validation-message">
          <div *ngIf="composeName.errors?.['required']">Name is required.</div>
          <div *ngIf="composeName.errors?.['minlength']">Name must be at least 2 characters long.</div>
          <div *ngIf="composeName.errors?.['maxlength']">Name must be at most 20 characters long.</div> <!-- NEW: رسالة maxlength -->
        </div>
      </div>

      <div class="form-group">
        <label for="composeEmail">Your Email:</label>
        <input type="email" id="composeEmail" name="composeEmail" [(ngModel)]="composeMailData.email"
               #composeEmail="ngModel" placeholder="your.email@example.com" required email>
        <div *ngIf="composeEmail.invalid && (composeEmail.dirty || composeEmail.touched)" class="validation-message">
          <div *ngIf="composeEmail.errors?.['required']">Email is required.</div>
          <div *ngIf="composeEmail.errors?.['email']">Please enter a valid email address.</div>
        </div>
      </div>

      <div class="form-group">
        <label for="composeSubject">Subject:</label>
        <input type="text" id="composeSubject" name="composeSubject" [(ngModel)]="composeMailData.subject"
               #composeSubject="ngModel" placeholder="Email Subject" required minlength="3">
        <div *ngIf="composeSubject.invalid && (composeSubject.dirty || composeSubject.touched)" class="validation-message">
          <div *ngIf="composeSubject.errors?.['required']">Subject is required.</div>
          <div *ngIf="composeSubject.errors?.['minlength']">Subject must be at least 3 characters long.</div>
        </div>
      </div>

      <div class="form-group">
        <label for="composeMessage">Message:</label>
        <textarea id="composeMessage" name="composeMessage" rows="8" [(ngModel)]="composeMailData.message"
                  #composeMessage="ngModel" placeholder="Your message here..." required minlength="10"></textarea>
        <div *ngIf="composeMessage.invalid && (composeMessage.dirty || composeMessage.touched)" class="validation-message">
          <div *ngIf="composeMessage.errors?.['required']">Message is required.</div>
          <div *ngIf="composeMessage.errors?.['minlength']">Message must be at least 10 characters long.</div>
        </div>
      </div>

      <!-- حاوية لرسائل حالة النموذج (تحميل، خطأ) -->
      <div class="form-status-container" aria-live="polite">
        <div *ngIf="isSendingMail" class="loading-spinner form-status">
          <i class="fas fa-spinner fa-spin"></i> Sending...
        </div>
        <div *ngIf="composeError" class="error-message form-status">
          <i class="fas fa-exclamation-triangle"></i> {{ composeError }}
        </div>
        <!-- تم إزالة رسالة النجاح النصية هنا، ستظهر في الـ popup -->
      </div>

      <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="!mailComposeForm.valid || isSendingMail">
            <i class="fas fa-paper-plane"></i> Send Email
          </button>
          <button type="button" class="btn btn-secondary" (click)="goBack()" [disabled]="isSendingMail">
            <i class="fas fa-times"></i> Cancel
          </button>
      </div>
    </form>
  </div>
</div>

<!-- NEW: Success Popup -->
<div *ngIf="showSuccessPopup" class="success-popup-overlay">
  <div class="success-popup-content">
    <i class="fas fa-check-circle success-icon"></i>
    <h3>Message Sent Successfully!</h3>
    <p>Your email has been sent and you will be redirected to the inbox shortly.</p>
  </div>
</div>
<!-- NEW: Success Popup -->
<div *ngIf="showSuccessPopup" class="success-popup-overlay">
  <div class="success-popup-content">
    <i class="fas fa-check-circle success-icon"></i>
    <h3>Message Sent Successfully!</h3>
    <p>Your email has been sent and you will be redirected to the inbox shortly.</p>
  </div>
</div>
