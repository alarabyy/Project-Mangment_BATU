<!-- File: src/app/components/nav/nav.component.html -->

<nav class="navbar" [class.dark]="isDarkMode" [class.search-active]="isSearchActive">
  <!-- Left Section -->
  <div class="navbar-section left">
    <button class="menu-toggle navbar-icon-btn" [class.active]="isMenuOpen" (click)="toggleMenu()" aria-label="Toggle Navigation Menu">
      <div class="hamburger"><span></span><span></span><span></span></div>
    </button>
  </div>
  <!-- Center Section -->
  <div class="navbar-section center">
    <a routerLink="/Home" class="logo" title="Go to Home">
      <i class="fas fa-sitemap"></i> <span>BATU-Projects</span>
    </a>
  </div>
  <!-- Right Section -->
  <div class="navbar-section right desktop-actions">
    <ng-container *ngIf="authService.isLoggedIn()">
      <div class="search-container">
          <button (click)="toggleSearch()" class="search-toggle navbar-icon-btn" title="Search"><i class="fas fa-search"></i></button>
          <div class="search-bar-container" [class.active]="isSearchActive">
              <input type="search" #searchInput placeholder="Search..." (keyup.enter)="performSearch(searchInput.value)"/>
              <button (click)="performSearch(searchInput.value)" class="search-submit-btn"><i class="fas fa-arrow-right"></i></button>
          </div>
      </div>
      <div class="global-add-container">
          <button class="navbar-icon-btn global-add-btn" (click)="toggleGlobalAdd()" title="Quick Add" [class.active]="isGlobalAddOpen"><i class="fas fa-plus"></i></button>
          <div class="global-add-menu" [class.show]="isGlobalAddOpen" [class.dark]="isDarkMode">
              <a (click)="quickCreate('project')"><i class="fas fa-folder-plus"></i> New Project</a>
          </div>
      </div>
      <a routerLink="/notifications" class="navbar-icon-btn notifications-btn" title="Notifications">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
      </a>
      <a routerLink="/MyProfile" class="navbar-icon-btn user-avatar-btn" title="My Profile"><i class="fas fa-user-graduate"></i></a>
    </ng-container>

    <button class="dark-mode-toggle navbar-icon-btn" (click)="toggleDarkMode()" title="Toggle Dark Mode">
      <span class="icon-container"><i class="fas fa-sun sun-icon"></i><i class="fas fa-moon moon-icon"></i></span>
    </button>
  </div>
  <div class="navbar-section right mobile-actions-trigger" *ngIf="authService.isLoggedIn()">
    <button class="navbar-icon-btn mobile-actions-toggle-btn" (click)="toggleMobileActionsMenu()" [class.active]="isMobileActionsMenuOpen"><i class="fas fa-ellipsis-v"></i></button>
  </div>
</nav>

<!-- Mobile Actions Menu -->
<div class="mobile-actions-menu" *ngIf="authService.isLoggedIn() && isMobileActionsMenuOpen" [class.show]="isMobileActionsMenuOpen" [class.dark]="isDarkMode">
    <a (click)="onMenuItemClick('/notifications')"><i class="fas fa-bell"></i> Notifications</a>
    <a (click)="onMenuItemClick('/projects/add')"><i class="fas fa-plus"></i> New Project</a>
    <a (click)="onMenuItemClick('/MyProfile')"><i class="fas fa-id-card"></i> My Profile</a>
    <hr>
    <a (click)="onLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
</div>

<!-- Sidebar Menu -->
<div class="dropdown-menu" [class.show]="isMenuOpen" [class.dark]="isDarkMode">
  <div class="menu-header" *ngIf="authService.isLoggedIn()">
    <div class="user-profile-compact">
        <i class="fas fa-user-circle menu-profile-icon"></i>
        <div class="user-details">
            <h4>Welcome, {{ userRole | titlecase }}!</h4>
            <p>Project Contributor</p>
        </div>
    </div>
    <button class="close-menu-btn" (click)="toggleMenu()">Ã—</button>
  </div>

  <ul class="menu-items">
    <ng-container *ngIf="authService.isLoggedIn()">
      <li class="menu-category"><span><i class="fas fa-user-circle"></i> General</span></li>
      <li><a (click)="onMenuItemClick('/projects')" routerLinkActive="active-link"><span class="menu-icon"><i class="fas fa-folder-open"></i></span>Projects</a></li>
      <li><a (click)="onMenuItemClick('/Chat')" routerLinkActive="active-link"><span class="menu-icon"><i class="fas fa-comments"></i></span>Ask AI</a></li>
      <li><a (click)="onMenuItemClick('/MyProfile')" routerLinkActive="active-link"><span class="menu-icon"><i class="fas fa-id-card"></i></span>My Profile</a></li>

      <ng-container *ngIf="userRole === 'admin'">
        <li class="menu-category"><span><i class="fas fa-user-shield"></i> Admin Panel</span></li>
        <li><a (click)="onMenuItemClick('/FacultyList')"><span class="menu-icon"><i class="fas fa-university"></i></span>Faculties</a></li>
        <li><a (click)="onMenuItemClick('/DepartmentsList')"><span class="menu-icon"><i class="fas fa-building"></i></span>Departments</a></li>
        <li><a (click)="onMenuItemClick('/CategoryList')"><span class="menu-icon"><i class="fas fa-tags"></i></span>Categories</a></li>
      </ng-container>

      <ng-container *ngIf="userRole === 'student'">
        <li class="menu-category"><span><i class="fas fa-user-graduate"></i> Student Zone</span></li>
        <li><a (click)="onMenuItemClick('/projects/add')"><span class="menu-icon"><i class="fas fa-plus-circle"></i></span>Add Project</a></li>
      </ng-container>

      <ng-container *ngIf="userRole === 'doctor' || userRole === 'professor'">
        <li class="menu-category"><span><i class="fas fa-user-md"></i> Doctor Tools</span></li>
        <li><a (click)="onMenuItemClick('/projects/add')"><span class="menu-icon"><i class="fas fa-plus-circle"></i></span>Add Project Idea</a></li>
      </ng-container>
    </ng-container>

    <li class="menu-separator"></li>
    <li><a (click)="onMenuItemClick('/Privacy')"><span class="menu-icon"><i class="fas fa-life-ring"></i></span>Help & Support</a></li>
    <li><a (click)="onMenuItemClick('/documentaion')"><span class="menu-icon"><i class="fas fa-folder-open"></i></span>Documentation</a></li>
    <hr>

    <ng-container *ngIf="!authService.isLoggedIn()">
      <li><a (click)="onMenuItemClick('/Login')"><span class="menu-icon"><i class="fas fa-sign-in-alt"></i></span>Login</a></li>
      <li><a (click)="onMenuItemClick('/SignUp')"><span class="menu-icon"><i class="fas fa-user-plus"></i></span>Sign Up</a></li>
    </ng-container>

    <li *ngIf="authService.isLoggedIn()">
      <a (click)="onLogout()" style="cursor: pointer;"><span class="menu-icon"><i class="fas fa-sign-out-alt"></i></span>Logout</a>
    </li>
  </ul>

  <div class="menu-footer">
    <p><i class="far fa-copyright"></i> {{ currentYear }} BATU-Projects. All rights reserved.</p>
  </div>
</div>
